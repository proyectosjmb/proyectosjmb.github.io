<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Biblioteca | Academy</title>
  <link rel="stylesheet" href="../../css/style.css" />
</head>
<body>
  <div class="container">
    <a href="../index.html" class="back-btn">&larr; Volver a Academy</a>

    <header>
      <h1>ğŸ§ <span>Biblioteca</span></h1>
      <p class="subtitle">Audios pÃºblicos en Drive + textos HTML dentro del repositorio. Filtra por tÃ­tulo, categorÃ­a o tags.</p>
    </header>

    <h2 class="section-title">ğŸ“ CategorÃ­as</h2>
    <div class="grid" aria-label="CategorÃ­as">
      <a class="card" href="ciencias.html">
        <div>
          <h3>ğŸ§ª Ciencias</h3>
          <p>FÃ­sica, quÃ­mica, astronomÃ­a y mÃ¡s.</p>
        </div>
        <span class="tag">Abrir</span>
      </a>

      <a class="card" href="historia.html">
        <div>
          <h3>ğŸº Historia</h3>
          <p>Relatos, civilizaciones y estrategias.</p>
        </div>
        <span class="tag">Abrir</span>
      </a>

      <a class="card" href="filosofia.html">
        <div>
          <h3>ğŸ§  FilosofÃ­a</h3>
          <p>Conceptos, autores y debates (prÃ³ximamente).</p>
        </div>
        <span class="tag">Abrir</span>
      </a>

      <a class="card" href="negocios.html">
        <div>
          <h3>ğŸ’¼ Negocios</h3>
          <p>Modelos, ventas, operaciones (opcional).</p>
        </div>
        <span class="tag">Abrir</span>
      </a>
    </div>

    <h2 class="section-title">ğŸ” Buscar</h2>
    <label class="sr-only" for="search">Buscar</label>
    <input
      id="search"
      class="search-bar"
      type="search"
      inputmode="search"
      autocomplete="off"
      placeholder="Buscar por tÃ­tulo, categorÃ­a o tagsâ€¦"
      aria-label="Buscar por tÃ­tulo, categorÃ­a o tags"
    />

    <div id="results" class="list" aria-live="polite"></div>
  </div>

  <script type="module">
    import { items } from "./data.js";

    const CATEGORY_LABELS = {
      ciencias: "Ciencias",
      historia: "Historia",
      filosofia: "FilosofÃ­a",
      negocios: "Negocios",
    };

    const searchInput = document.getElementById("search");
    const results = document.getElementById("results");

    function normalizeText(value) {
      return String(value ?? "")
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    }

    function matchesQuery(item, query) {
      if (!query) return true;
      const haystack = [item.title, item.category, ...(Array.isArray(item.tags) ? item.tags : [])]
        .map(normalizeText)
        .join(" ");
      return haystack.includes(query);
    }

    function createTagBadge(tag) {
      const badge = document.createElement("span");
      badge.className = "badge";
      badge.textContent = tag;
      return badge;
    }

    function createItemRow(item) {
      const row = document.createElement("div");
      row.className = "item";

      const main = document.createElement("div");
      main.className = "item-main";

      const title = document.createElement("h3");
      title.textContent = item.title;

      const meta = document.createElement("div");
      meta.className = "item-meta";

      const date = document.createElement("span");
      date.textContent = item.date ? item.date : "";

      const category = document.createElement("span");
      category.textContent = item.category ? ` â€¢ ${CATEGORY_LABELS[item.category] ?? item.category}` : "";

      const tagsWrap = document.createElement("div");
      tagsWrap.className = "item-tags";
      (Array.isArray(item.tags) ? item.tags : []).forEach((t) => tagsWrap.appendChild(createTagBadge(t)));

      meta.appendChild(date);
      meta.appendChild(category);
      meta.appendChild(tagsWrap);

      main.appendChild(title);
      main.appendChild(meta);

      const actions = document.createElement("div");
      actions.className = "item-actions";

      const listen = document.createElement("a");
      listen.className = "btn";
      listen.href = item.audioUrl;
      listen.target = "_blank";
      listen.rel = "noopener";
      listen.textContent = "Escuchar ğŸ§";

      const read = document.createElement("a");
      read.className = "btn";
      read.href = item.textUrl;
      read.target = "_blank";
      read.rel = "noopener";
      read.textContent = "Leer ğŸ“„";

      actions.appendChild(listen);
      actions.appendChild(read);

      row.appendChild(main);
      row.appendChild(actions);
      return row;
    }

    function renderList(list) {
      results.replaceChildren();

      if (!list.length) {
        const empty = document.createElement("div");
        empty.className = "item";
        empty.textContent = "No hay resultados con ese filtro.";
        results.appendChild(empty);
        return;
      }

      list.forEach((item) => results.appendChild(createItemRow(item)));
    }

    function applyFilter() {
      const query = normalizeText(searchInput.value);
      const filtered = items.filter((item) => matchesQuery(item, query));
      renderList(filtered);
    }

    searchInput.addEventListener("input", applyFilter);
    applyFilter();
  </script>
</body>
</html>

