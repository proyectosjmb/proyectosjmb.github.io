<!-- 
    ****************************************************************************
    üü¢ ARCHIVO: research/index.html
    UBICACI√ìN: Carpeta "research"
    
    DESCRIPCI√ìN:
    Laboratorio de Investigaci√≥n + Bandeja de Entrada (Inbox).
    ACTUALIZACI√ìN: Bot√≥n moderno y sistema de EDICI√ìN de notas.
    ****************************************************************************
-->

<!DOCTYPE html>
<html lang="es">
<head>
    <!-- ======================================================= -->
    <!-- üü¢ CONFIGURACI√ìN T√âCNICA -->
    <!-- ======================================================= -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Lab | JMB</title>

    <!-- CONEXI√ìN CSS -->
    <link rel="stylesheet" href="../css/style.css">

    <!-- üü¢ ESTILOS EXTRA (CSS INTERNO) -->
    <style>
        /* Estilo para el √°rea de captura */
        .input-zone {
            background-color: #1e293b;
            padding: 25px;
            border-radius: 16px; /* Bordes m√°s redondeados */
            margin-bottom: 30px;
            border: 1px solid #334155;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Inputs (Cajas de texto) */
        .input-field {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #0f172a;
            border: 1px solid #334155;
            color: #f8fafc;
            border-radius: 8px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #38bdf8; /* Azul al escribir */
        }

        textarea.input-field {
            min-height: 100px;
            resize: vertical;
        }

        /* --- BOT√ìN MODERNO (FLOTANTE) --- */
        .btn-save {
            width: 100%;
            /* Degradado moderno */
            background: linear-gradient(135deg, #38bdf8 0%, #0284c7 100%);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            
            /* Efecto de sombra y flotaci√≥n */
            box-shadow: 0 10px 15px -3px rgba(56, 189, 248, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-save:hover {
            transform: translateY(-3px); /* Se eleva */
            box-shadow: 0 20px 25px -5px rgba(56, 189, 248, 0.5); /* Sombra crece */
            filter: brightness(1.1);
        }

        .btn-save:active {
            transform: translateY(1px); /* Efecto de clic */
        }

        /* Estilo diferente cuando estamos EDITANDO */
        .btn-save.editing {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); /* Naranja */
            box-shadow: 0 10px 15px -3px rgba(245, 158, 11, 0.4);
        }

        /* --- TARJETAS DE IDEAS --- */
        .idea-card {
            background-color: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border-left: 5px solid #38bdf8;
            margin-bottom: 20px;
            position: relative;
            animation: fadeIn 0.5s ease;
        }

        /* Animaci√≥n de entrada suave */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* BOTONES DE ACCI√ìN (Editar / Borrar) */
        .action-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: rgba(15, 23, 42, 0.5);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .btn-edit { color: #f59e0b; } /* L√°piz amarillo */
        .btn-edit:hover { background-color: #f59e0b; color: #fff; }

        .btn-delete { color: #ef4444; } /* Tache rojo */
        .btn-delete:hover { background-color: #ef4444; color: #fff; }
        
        /* Links dentro de las notas */
        .idea-content a { color: #38bdf8; text-decoration: underline; }
    </style>
</head>

<body>

    <div class="container">
        
        <!-- BOT√ìN VOLVER -->
        <a href="../index.html" class="back-btn">&larr; Volver al Inicio</a>

        <header>
            <h1>üî¨ Research <span>Lab</span></h1>
            <p class="subtitle">Bandeja de entrada de ideas e investigaciones profundas.</p>
        </header>

        <!-- ======================================================= -->
        <!-- üü¢ SECCI√ìN 1: CAPTURA R√ÅPIDA (INBOX) -->
        <!-- ======================================================= -->
        <div class="input-zone" id="zonaFormulario">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>üì• Captura R√°pida</h3>
                <!-- Indicador visual de modo edici√≥n (oculto por defecto) -->
                <span id="indicadorEdicion" style="display: none; color: #f59e0b; font-size: 0.9rem; font-weight: bold;">‚úèÔ∏è MODO EDICI√ìN</span>
            </div>
            
            <!-- Campo oculto para saber si estamos editando una ID espec√≠fica -->
            <input type="hidden" id="idEdicion" value="">

            <input type="text" id="tituloInput" class="input-field" placeholder="T√≠tulo de la idea (Ej: Video sobre ayuno...)">
            <textarea id="notaInput" class="input-field" placeholder="Pega aqu√≠ URLs, notas r√°pidas o referencias..."></textarea>
            
            <button onclick="guardarIdea()" id="btnGuardar" class="btn-save">üíæ Guardar en Bandeja</button>
            
            <!-- Bot√≥n para cancelar edici√≥n (oculto por defecto) -->
            <button onclick="cancelarEdicion()" id="btnCancelar" style="display: none; width: 100%; margin-top: 10px; background: transparent; border: 1px solid #475569; color: #94a3b8; padding: 10px; border-radius: 6px; cursor: pointer;">Cancelar Edici√≥n</button>
        </div>

        <!-- CONTENEDOR DE IDEAS DIN√ÅMICAS -->
        <div id="contenedorIdeas" class="grid" style="margin-bottom: 4rem;">
            <!-- Aqu√≠ se inyectan las tarjetas con JS -->
        </div>


        <!-- ======================================================= -->
        <!-- üü¢ SECCI√ìN 2: L√çNEAS DE INVESTIGACI√ìN (EST√ÅTICAS) -->
        <!-- ======================================================= -->
        <h2 style="margin-bottom: 20px; border-top: 1px solid #334155; padding-top: 20px;">üóÇÔ∏è Archivos de Investigaci√≥n</h2>
        
        <div class="grid">
            
            <!-- CARD 1 -->
            <a href="#" class="card">
                <div>
                    <h3>üåø Salud & Biohacking</h3>
                    <p>Protocolos de optimizaci√≥n f√≠sica.</p>
                    <ul style="margin-top: 10px; padding-left: 20px; color: #94a3b8; font-size: 0.85rem;">
                        <li>Aumentar Testosterona & Alimentaci√≥n Consciente</li>
                        <li>Investigaci√≥n Resveratrol</li>
                        <li>Or√©gano, Disbiosis y Herbolaria</li>
                    </ul>
                </div>
                <span class="tag">Leer Notas üìÑ</span>
            </a>

            <!-- CARD 2 -->
            <a href="#" class="card">
                <div>
                    <h3>‚öñÔ∏è Sociedad y Econom√≠a</h3>
                    <p>An√°lisis sobre Riqueza, Trabajo y Desigualdad.</p>
                </div>
                <span class="tag">Leer Ensayos üìÑ</span>
            </a>

            <!-- CARD 3 -->
            <a href="#" class="card">
                <div>
                    <h3>üîÆ Energ√≠a & Herramientas</h3>
                    <p>Estudios sobre varillas de radiestesia.</p>
                </div>
                <span class="tag">Ver Investigaci√≥n üìÑ</span>
            </a>

        </div>
    </div>


    <!-- ======================================================= -->
    <!-- üü¢ CEREBRO JAVASCRIPT: L√ìGICA DE GUARDADO Y EDICI√ìN -->
    <!-- ======================================================= -->
    <script>
        // Cargar ideas al iniciar
        document.addEventListener('DOMContentLoaded', cargarIdeas);

        /**
         * FUNCI√ìN PRINCIPAL: Guardar o Actualizar
         * Decide si crea una nueva o modifica una existente seg√∫n si hay un ID oculto.
         */
        function guardarIdea() {
            const titulo = document.getElementById('tituloInput').value;
            const nota = document.getElementById('notaInput').value;
            const idEdicion = document.getElementById('idEdicion').value; // ¬øHay un ID pendiente?

            if (titulo.trim() === "") {
                alert("‚ö†Ô∏è Por favor escribe un t√≠tulo.");
                return;
            }

            // Recuperar lista actual
            let listaIdeas = JSON.parse(localStorage.getItem('misIdeasResearch') || '[]');

            if (idEdicion) {
                // --- MODO ACTUALIZAR ---
                // Buscamos la idea vieja y le cambiamos los datos
                const indice = listaIdeas.findIndex(idea => idea.id == idEdicion);
                if (indice !== -1) {
                    listaIdeas[indice].titulo = titulo;
                    listaIdeas[indice].nota = nota;
                    // No cambiamos la fecha original, o podr√≠amos poner fecha de edici√≥n
                }
                // Salimos del modo edici√≥n
                cancelarEdicion();
            } else {
                // --- MODO CREAR NUEVO ---
                const nuevaIdea = {
                    id: Date.now(),
                    titulo: titulo,
                    nota: nota,
                    fecha: new Date().toLocaleDateString()
                };
                listaIdeas.unshift(nuevaIdea); // Agregar al principio
            }

            // Guardar en navegador y refrescar pantalla
            localStorage.setItem('misIdeasResearch', JSON.stringify(listaIdeas));
            
            // Limpiar formulario solo si no estamos editando (aunque cancelarEdicion ya lo hace)
            if (!idEdicion) {
                document.getElementById('tituloInput').value = "";
                document.getElementById('notaInput').value = "";
            }
            
            cargarIdeas();
        }

        /**
         * FUNCI√ìN: Cargar Ideas
         * Dibuja las tarjetas en la pantalla
         */
        function cargarIdeas() {
            let listaIdeas = JSON.parse(localStorage.getItem('misIdeasResearch') || '[]');
            const contenedor = document.getElementById('contenedorIdeas');
            contenedor.innerHTML = "";

            listaIdeas.forEach(idea => {
                let notaFormat = idea.nota.replace(/\n/g, "<br>");

                // Detectar URLs b√°sicas para hacerlas clicables
                // (Expresi√≥n regular simple para detectar http/https)
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                notaFormat = notaFormat.replace(urlRegex, function(url) {
                    return `<a href="${url}" target="_blank">${url}</a>`;
                });

                const tarjetaHTML = `
                    <div class="idea-card">
                        <div class="action-buttons">
                            <!-- Bot√≥n Editar (L√°piz) -->
                            <button onclick="prepararEdicion(${idea.id})" class="icon-btn btn-edit" title="Editar">‚úèÔ∏è</button>
                            <!-- Bot√≥n Borrar (X) -->
                            <button onclick="borrarIdea(${idea.id})" class="icon-btn btn-delete" title="Borrar">√ó</button>
                        </div>
                        
                        <h3 style="color: #f8fafc; margin-bottom: 5px; padding-right: 70px;">${idea.titulo}</h3>
                        <small style="color: #64748b;">üìÖ ${idea.fecha}</small>
                        
                        <p style="color: #94a3b8; margin-top: 10px; word-break: break-word;" class="idea-content">
                            ${notaFormat}
                        </p>
                    </div>
                `;
                contenedor.innerHTML += tarjetaHTML;
            });
        }

        /**
         * FUNCI√ìN: Borrar Idea
         */
        function borrarIdea(id) {
            if(confirm("¬øEliminar esta idea?")) {
                let listaIdeas = JSON.parse(localStorage.getItem('misIdeasResearch') || '[]');
                listaIdeas = listaIdeas.filter(idea => idea.id !== id);
                localStorage.setItem('misIdeasResearch', JSON.stringify(listaIdeas));
                cargarIdeas();
                
                // Si borramos la que est√°bamos editando, cancelar edici√≥n
                if (document.getElementById('idEdicion').value == id) {
                    cancelarEdicion();
                }
            }
        }

        /**
         * FUNCI√ìN: Preparar Edici√≥n
         * Sube los datos de la tarjeta al formulario
         */
        function prepararEdicion(id) {
            let listaIdeas = JSON.parse(localStorage.getItem('misIdeasResearch') || '[]');
            const idea = listaIdeas.find(i => i.id === id);

            if (idea) {
                // 1. Rellenar formulario
                document.getElementById('tituloInput').value = idea.titulo;
                document.getElementById('notaInput').value = idea.nota;
                document.getElementById('idEdicion').value = idea.id;

                // 2. Cambiar aspecto visual del bot√≥n
                const btn = document.getElementById('btnGuardar');
                btn.innerHTML = "üîÑ Actualizar Idea";
                btn.classList.add('editing'); // Se vuelve naranja

                // 3. Mostrar bot√≥n cancelar y texto de aviso
                document.getElementById('btnCancelar').style.display = "block";
                document.getElementById('indicadorEdicion').style.display = "block";

                // 4. Scroll suave hacia arriba para ver el formulario
                document.getElementById('zonaFormulario').scrollIntoView({ behavior: 'smooth' });
            }
        }

        /**
         * FUNCI√ìN: Cancelar Edici√≥n
         * Limpia todo y devuelve el bot√≥n a su estado normal
         */
        function cancelarEdicion() {
            document.getElementById('tituloInput').value = "";
            document.getElementById('notaInput').value = "";
            document.getElementById('idEdicion').value = "";

            const btn = document.getElementById('btnGuardar');
            btn.innerHTML = "üíæ Guardar en Bandeja";
            btn.classList.remove('editing'); // Vuelve a ser azul

            document.getElementById('btnCancelar').style.display = "none";
            document.getElementById('indicadorEdicion').style.display = "none";
        }
    </script>

</body>
</html>
